<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PEI Comunitario ‚Äì ENS Gabriela Mistral</title>
<style>
:root {
    --azul-oscuro: #0066a6;
    --azul-bandera: #37b7ff;
    --amarillo-cinta: #ffc800;
    --gris-fondo: #f2f4f8;
    --texto-principal: #1f2933;
}
body {
    margin: 0;
    font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
    background: var(--gris-fondo);
    color: var(--texto-principal);
}
header {
    background: linear-gradient(180deg, var(--azul-bandera) 0%, var(--azul-oscuro) 100%);
    color: white;
    padding: 20px 16px 18px 16px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
header h1 {
    margin: 8px 0 0 0;
    font-size: 24px;
}
#logo {
    width: 90px;
    height: 110px;
    object-fit: contain;
    margin-bottom: 4px;
}
.subtitulo {
    text-align: center;
    font-size: 13px;
    margin-top: 4px;
    color: #eef6ff;
    letter-spacing: 0.5px;
}
.flag-strip {
    height: 10px;
    background: linear-gradient(180deg, var(--azul-bandera) 0%, #ffffff 50%, #ffffff 100%);
}
.container {
    max-width: 980px;
    margin: 0 auto;
    padding: 16px;
}
.card {
    background: #ffffff;
    border-radius: 14px;
    padding: 16px 16px 18px 16px;
    box-shadow: 0 2px 8px rgba(15,23,42,0.08);
    margin-bottom: 20px;
    border-top: 4px solid var(--azul-bandera);
}
.card h2 {
    margin-top: 0;
    display: flex;
    align-items: center;
    gap: 6px;
}
.gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin-top: 10px;
}
.gallery-item {
    background: #f9fafb;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    border: 1px solid #e2e8f0;
}
.gallery-item img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
}
.gallery-item h3 {
    margin: 8px 0 4px 0;
    font-size: 14px;
}
.gallery-item p {
    margin: 0;
    font-size: 12px;
    color: #4b5563;
}
.section-btn {
    width: 100%;
    background: #ffffff;
    border: 2px solid var(--azul-oscuro);
    color: var(--azul-oscuro);
    padding: 10px 12px;
    margin-bottom: 6px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: 0.2s;
}
.section-btn span.icon {
    font-size: 18px;
}
.section-btn:hover {
    background: var(--azul-oscuro);
    color: #ffffff;
}
.section-content {
    display: none;
    background: #ffffff;
    padding: 12px 12px 10px 12px;
    border-left: 2px solid var(--azul-oscuro);
    border-right: 2px solid var(--azul-oscuro);
    border-bottom: 2px solid var(--azul-oscuro);
    border-radius: 0 0 10px 10px;
    margin-bottom: 10px;
    animation: fadeIn 0.22s ease-in;
}
.section-content ul {
    padding-left: 20px;
}
.map-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(130px,1fr));
    gap: 10px;
    margin-top: 10px;
}
.chip {
    background: var(--azul-oscuro);
    color: white;
    padding: 12px;
    border-radius: 999px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    transition: 0.2s;
}
.chip:hover {
    background: var(--azul-bandera);
    transform: translateY(-1px);
}
.chip-info {
    display: none;
    background: #ffffff;
    border-radius: 10px;
    padding: 10px 12px;
    margin-top: 10px;
    font-size: 14px;
    border: 1px solid #e5e7eb;
}
.chip-info h3 {
    margin: 4px 0 4px 0;
    font-size: 15px;
}
.chip-info ul {
    margin: 4px 0 8px 18px;
    padding: 0;
}
.ally-impact {
    margin-top: 4px;
    font-size: 12px;
}
.ally-impact-label {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
}
.ally-impact-bar-wrap {
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
    height: 10px;
}
.ally-impact-bar {
    height: 10px;
    background: var(--amarillo-cinta);
    border-radius: 999px;
}
.survey-box {
    background: #ffffff;
    border-radius: 12px;
    padding: 12px;
    border: 1px solid #e5e7eb;
}
.option-btn {
    width: 100%;
    margin-top: 8px;
    padding: 9px 10px;
    background: var(--azul-oscuro);
    color:white;
    border: none;
    border-radius: 999px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    transition: 0.2s;
}
.option-btn:hover {
    background: var(--azul-bandera);
}
.results {
    margin-top: 14px;
    display: none;
}
.results-row {
    margin-bottom: 10px;
    font-size: 13px;
}
.result-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 8px;
    margin-bottom: 4px;
}
.result-label {
    font-size: 12px;
    color: #4b5563;
}
.bar-wrapper {
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
    height: 16px;
}
.bar {
    height: 16px;
    background: var(--amarillo-cinta);
    border-radius: 999px;
    transition: width 0.3s;
}
#downloadBtn, #resetBtn {
    background: var(--amarillo-cinta);
    border: none;
    padding: 9px 10px;
    border-radius: 999px;
    margin-top: 8px;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    font-size: 13px;
}
#downloadBtn:hover, #resetBtn:hover {
    background: #ffb400;
}
#resetBtn {
    background: #e5e7eb;
}
#resetBtn:hover {
    background: #d1d5db;
}
.survey-secondary {
    margin-top: 16px;
    border-top: 1px dashed #d1d5db;
    padding-top: 10px;
}
.survey-secondary h4 {
    margin: 4px 0 6px 0;
    font-size: 14px;
}
.wall-form {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}
.wall-form select,
.wall-form textarea,
.wall-form input {
    font-family: inherit;
    font-size: 13px;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
}
.wall-form textarea {
    resize: vertical;
    min-height: 70px;
}
.wall-btn {
    align-self: flex-end;
    background: var(--azul-oscuro);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
}
.wall-btn:hover {
    background: var(--azul-bandera);
}
.wall-list {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 10px;
}
.wall-item {
    background: #f9fafb;
    border-radius: 10px;
    padding: 8px 10px;
    border-left: 4px solid var(--azul-bandera);
    font-size: 13px;
}
.wall-item-header {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    font-size: 12px;
    margin-bottom: 4px;
    color: #374151;
}
.wall-item-meta {
    font-size: 11px;
    color: #6b7280;
    margin-bottom: 4px;
}
.wall-item-body {
    font-size: 13px;
}
.indicators {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 8px;
    font-size: 12px;
}
.indicator-pill {
    background: #e5f3ff;
    border-radius: 999px;
    padding: 5px 10px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    border: 1px solid #bfdbfe;
}
.indicator-pill span.value {
    font-weight: 700;
}
footer {
    background: var(--azul-oscuro);
    color: white;
    text-align: center;
    padding: 14px 10px;
    margin-top: 24px;
    font-size: 13px;
}

/* Panel de control remoto (solo m√≥vil) */
.control-toggle {
    position: fixed;
    right: 12px;
    bottom: 12px;
    z-index: 40;
    background: var(--amarillo-cinta);
    border: none;
    border-radius: 999px;
    padding: 10px 14px;
    font-size: 13px;
    font-weight: 700;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    cursor: pointer;
}
.control-panel {
    position: fixed;
    right: 10px;
    bottom: 56px;
    z-index: 39;
    max-width: 260px;
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(15,23,42,0.4);
    border: 1px solid #e5e7eb;
    display: none;
}
.control-panel-inner {
    padding: 10px 10px 8px 10px;
}
.control-title {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 6px;
}
.control-buttons {
    display: grid;
    grid-template-columns: repeat(2,minmax(0,1fr));
    gap: 6px;
    margin-bottom: 6px;
}
.control-btn {
    font-size: 11px;
    padding: 6px 8px;
    border-radius: 999px;
    border: none;
    background: #e5f3ff;
    color: #111827;
    cursor: pointer;
}
.control-btn:hover {
    background: #dbeafe;
}
.control-close {
    width: 100%;
    font-size: 11px;
    padding: 6px 8px;
    border-radius: 999px;
    border: none;
    background: #e5e7eb;
    cursor: pointer;
}

/* Ocultar control remoto en pantallas grandes (PC/proyector) */
@media (min-width: 801px){
    .control-toggle,
    .control-panel {
        display: none !important;
    }
}

@keyframes fadeIn {
    from {opacity:0; transform: translateY(-3px);}
    to {opacity:1; transform: translateY(0);}
}
@media (max-width: 600px){
    header h1 {
        font-size: 20px;
    }
    .container {
        padding: 12px;
    }
}
</style>
</head>

<body>

<header>
    <img id="logo" src="escudo.png" alt="Escudo ENS Gabriela Mistral">
    <h1>PEI Comunitario ‚Äì ENS Gabriela Mistral</h1>
    <div class="subtitulo">Presentaci√≥n interactiva del componente comunitario</div>
</header>
<div class="flag-strip"></div>

<div class="container">

    <div class="card" id="card-bienvenida">
        <h2>üìò Bienvenida</h2>
        <p>
            Esta aplicaci√≥n web acompa√±a la exposici√≥n del componente comunitario del PEI de la 
            Escuela Normal Superior Gabriela Mistral de Orito ‚Äì Putumayo. 
            Permite a los asistentes explorar la informaci√≥n por secciones, reconocer los aliados del territorio
            y participar en una breve encuesta y un muro de aportes.
        </p>
        <p style="font-size:13px; color:#4b5563;">
            Sugerencia para el expositor: pide a los asistentes que ingresen al enlace desde su celular 
            y utiliza la pantalla principal para proyectar las secciones y los resultados. Los votos y aportes 
            se sincronizan en tiempo real usando una base de datos en la nube.
        </p>
        <div class="indicators">
            <div class="indicator-pill">üó≥Ô∏è Votos registrados (global): <span id="votesTotal" class="value">0</span></div>
            <div class="indicator-pill">üí¨ Aportes en el muro (global): <span id="wallTotal" class="value">0</span></div>
        </div>
    </div>

    <div class="card" id="card-simbolos">
        <h2>üè≥Ô∏è S√≠mbolos institucionales</h2>
        <div class="gallery">
            <div class="gallery-item">
                <img src="bandera.png" alt="Bandera ENS Gabriela Mistral">
                <h3>Bandera institucional</h3>
                <p>Colores que representan la identidad de la ENS Gabriela Mistral y su territorio amaz√≥nico.</p>
            </div>
            <div class="gallery-item">
                <img src="escudo.png" alt="Escudo ENS Gabriela Mistral">
                <h3>Escudo institucional</h3>
                <p>S√≠mbolos de sabidur√≠a, paz y liderazgo como pilares de la formaci√≥n docente.</p>
            </div>
        </div>
    </div>

    <div class="card" id="card-explorador">
        <h2>üîé Explorador del componente comunitario</h2>

        <button class="section-btn" onclick="toggleSection('s1')">
            <span>Componentes comunitarios</span><span class="icon">‚ñæ</span>
        </button>
        <div id="s1" class="section-content">
            <p>
                El componente comunitario visibiliza la interacci√≥n de la ENS Gabriela Mistral con la comunidad 
                del Bajo Putumayo y el sector productivo, con √©nfasis en:
            </p>
            <ul>
                <li>Conciencia social y compromiso con la transformaci√≥n del territorio.</li>
                <li>Participaci√≥n comunitaria, solidaridad y trabajo colaborativo.</li>
                <li>Formaci√≥n de docentes con enfoque social, intercultural y amaz√≥nico.</li>
                <li>Alianzas y convenios para responder a necesidades locales y regionales.</li>
            </ul>
        </div>

        <button class="section-btn" onclick="toggleSection('s2')">
            <span>Organizaciones activas del Bajo Putumayo</span><span class="icon">‚ñæ</span>
        </button>
        <div id="s2" class="section-content">
            <p>Algunas organizaciones clave para el trabajo comunitario son:</p>
            <ul>
                <li>Alianza Departamental de Mujeres Tejedoras de Vida.</li>
                <li>Centro Nacional de Memoria Hist√≥rica y procesos de memoria local.</li>
                <li>Organizaciones √©tnicas ind√≠genas y afrodescendientes (Inga, Kam√´nts√°, FEDECAP, entre otras).</li>
                <li>Fundaciones ambientales y entidades como Corpoamazon√≠a y Parques Nacionales.</li>
                <li>Emprendimientos y ferias que promueven productos amaz√≥nicos y econom√≠a local.</li>
            </ul>
        </div>

        <button class="section-btn" onclick="toggleSection('s3')">
            <span>Medios, sindicatos e instituciones</span><span class="icon">‚ñæ</span>
        </button>
        <div id="s3" class="section-content">
            <p>Entre los actores que acompa√±an y fortalecen la labor educativa se encuentran:</p>
            <ul>
                <li>Emisoras comunitarias y medios locales que difunden informaci√≥n y cultura.</li>
                <li>Sindicatos como la Uni√≥n Sindical Obrera (USO) vinculados al contexto petrolero.</li>
                <li>CLOPAD, Defensa Civil, Cruz Roja, Bomberos, Polic√≠a y Ej√©rcito como instancias de apoyo.</li>
                <li>Hospitales y entidades de salud que desarrollan acciones de promoci√≥n y prevenci√≥n.</li>
                <li>Parroquias, iglesias cristianas y Casa de la Cultura como espacios comunitarios.</li>
            </ul>
        </div>

        <button class="section-btn" onclick="toggleSection('s4')">
            <span>Estrategias culturales y pedag√≥gicas</span><span class="icon">‚ñæ</span>
        </button>
        <div id="s4" class="section-content">
            <p>Las estrategias buscan articular la escuela con las expresiones culturales, locales y regionales:</p>
            <ul>
                <li>Di√°logo intercultural y c√≠rculos de saberes con comunidades ind√≠genas y afrodescendientes.</li>
                <li>Reconocimiento de festividades locales, carnavales y pr√°cticas como la minga.</li>
                <li>Inclusi√≥n de saberes ancestrales, medicina tradicional y cosmovisiones amaz√≥nicas.</li>
                <li>Uso de materiales educativos interculturales que representen la diversidad del territorio.</li>
                <li>Promoci√≥n de la empat√≠a, el respeto y la participaci√≥n activa de los estudiantes.</li>
            </ul>
        </div>

        <button class="section-btn" onclick="toggleSection('s5')">
            <span>Proyectos, semilleros y convenios</span><span class="icon">‚ñæ</span>
        </button>
        <div id="s5" class="section-content">
            <p>La ENS Gabriela Mistral fortalece su proyecci√≥n comunitaria mediante:</p>
            <ul>
                <li>Proyectos CRECE, PTA y transversales en convivencia, medio ambiente, lectura e inclusi√≥n.</li>
                <li>Proyectos institucionales y semilleros de investigaci√≥n articulados al Programa de Formaci√≥n Complementaria.</li>
                <li>Articulaci√≥n con SENA, UNISALLE, ENSUP, UNIPUTUMAYO y otras entidades educativas.</li>
                <li>Convenios con organizaciones gubernamentales y no gubernamentales para la formaci√≥n docente y la educaci√≥n ambiental.</li>
            </ul>
        </div>
    </div>

    <div class="card" id="card-mapa">
        <h2>üó∫Ô∏è Mapa vivo de aliados y actores</h2>
        <p style="font-size:14px;">
            Toca cada bloque para ver el rol de cada entidad en el trabajo comunitario de la ENS Gabriela Mistral.
        </p>

        <div class="map-grid">
            <div class="chip" onclick="showInfo('m1')">SENA</div>
            <div class="chip" onclick="showInfo('m2')">Corpoamazon√≠a</div>
            <div class="chip" onclick="showInfo('m3')">UNISALLE</div>
            <div class="chip" onclick="showInfo('m4')">Tejedoras de Vida</div>
            <div class="chip" onclick="showInfo('m5')">FEDECAP</div>
            <div class="chip" onclick="showInfo('m6')">E.S.E. Hospital</div>
            <div class="chip" onclick="showInfo('m7')">Cruz Roja</div>
            <div class="chip" onclick="showInfo('m8')">Bomberos</div>
        </div>

        <div id="m1" class="chip-info">
            <h3>SENA ‚Äì Programas en la ENSGM</h3>
            <ul>
                <li>Programa t√©cnico en <b>Auxiliar Administrativo</b>.</li>
                <li>Programa t√©cnico en <b>Emprendimiento</b>.</li>
                <li>Acompa√±amiento a proyectos productivos escolares.</li>
                <li>Articulaci√≥n con media y formaci√≥n para el trabajo.</li>
            </ul>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Formaci√≥n para el trabajo</span><span>90%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:90%"></div></div>
            </div>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Emprendimiento estudiantil</span><span>85%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:85%"></div></div>
            </div>
        </div>

        <div id="m2" class="chip-info">
            <h3>Corpoamazon√≠a</h3>
            <ul>
                <li>Procesos de educaci√≥n ambiental en el Bajo Putumayo.</li>
                <li>Acompa√±amiento a proyectos de biodiversidad y conservaci√≥n.</li>
                <li>Apoyo en jornadas pedag√≥gicas sobre protecci√≥n de la Amazon√≠a.</li>
            </ul>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Educaci√≥n ambiental</span><span>88%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:88%"></div></div>
            </div>
        </div>

        <div id="m3" class="chip-info">
            <h3>UNISALLE</h3>
            <ul>
                <li>Formaci√≥n inicial y continua de docentes.</li>
                <li>Acompa√±amiento a procesos de investigaci√≥n educativa.</li>
                <li>Espacios de reflexi√≥n pedag√≥gica y pr√°ctica docente.</li>
            </ul>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Actualizaci√≥n docente</span><span>92%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:92%"></div></div>
            </div>
        </div>

        <div id="m4" class="chip-info">
            <h3>Alianza Tejedoras de Vida</h3>
            <ul>
                <li>Promoci√≥n de derechos de las mujeres en el territorio.</li>
                <li>Procesos de memoria, tejido social y paz territorial.</li>
                <li>Actividades formativas con estudiantes y familias.</li>
            </ul>
        </div>

        <div id="m5" class="chip-info">
            <h3>FEDECAP y organizaciones afro</h3>
            <ul>
                <li>Fortalecimiento de la identidad afrodescendiente.</li>
                <li>Procesos organizativos comunitarios en el Bajo Putumayo.</li>
                <li>Acompa√±amiento a c√°tedra de estudios afro y etnoeducaci√≥n.</li>
            </ul>
        </div>

        <div id="m6" class="chip-info">
            <h3>E.S.E. Hospital ‚Äì Estrategias de salud</h3>
            <ul>
                <li>Estrategias de <b>tamizaje socioemocional</b> con estudiantes.</li>
                <li>Campa√±as de promoci√≥n y prevenci√≥n en salud integral.</li>
                <li>Trabajo articulado en jornadas de bienestar escolar.</li>
            </ul>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Bienestar socioemocional</span><span>87%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:87%"></div></div>
            </div>
        </div>

        <div id="m7" class="chip-info">
            <h3>Cruz Roja</h3>
            <ul>
                <li>Apoyo en emergencias y acompa√±amiento psicosocial.</li>
                <li>Formaci√≥n b√°sica en primeros auxilios.</li>
                <li>Participaci√≥n en simulacros y campa√±as humanitarias.</li>
            </ul>
        </div>

        <div id="m8" class="chip-info">
            <h3>Bomberos ‚Äì Primeros auxilios y prevenci√≥n</h3>
            <ul>
                <li>Capacitaciones en <b>primeros auxilios b√°sicos</b>.</li>
                <li>Simulacros de evacuaci√≥n y manejo de emergencias.</li>
                <li>Charlas sobre uso adecuado de extintores y prevenci√≥n de incendios.</li>
            </ul>
            <div class="ally-impact">
                <div class="ally-impact-label">
                    <span>Gesti√≥n del riesgo</span><span>89%</span>
                </div>
                <div class="ally-impact-bar-wrap"><div class="ally-impact-bar" style="width:89%"></div></div>
            </div>
        </div>
    </div>

    <div class="card" id="card-encuesta">
        <h2>üìä Encuesta interactiva</h2>
        <p style="font-size:14px;">
            Marca, desde tu percepci√≥n, cu√°l deber√≠a ser la prioridad para fortalecer el componente comunitario
            en los pr√≥ximos a√±os. Luego, responde una pregunta r√°pida sobre qu√© actor deber√≠a vincularse con m√°s fuerza.
            Los votos se cuentan de manera global.
        </p>

        <div class="survey-box">
            <p><b>Pregunta 1. ¬øQu√© estrategia debe fortalecerse primero?</b></p>

            <button class="option-btn" onclick="vote(0)">Inclusi√≥n (PIAR e interculturalidad)</button>
            <button class="option-btn" onclick="vote(1)">Convenios y aliados estrat√©gicos</button>
            <button class="option-btn" onclick="vote(2)">Proyectos transversales y semilleros</button>
            <button class="option-btn" onclick="vote(3)">Emprendimiento y formaci√≥n para el trabajo</button>

            <div class="survey-secondary">
                <h4>Pregunta 2. ¬øQu√© actor debe reforzar su presencia en la ENS?</h4>
                <button class="option-btn" onclick="voteSecondary(0)">Organizaciones √©tnicas</button>
                <button class="option-btn" onclick="voteSecondary(1)">Sector productivo local</button>
                <button class="option-btn" onclick="voteSecondary(2)">Universidades aliadas</button>
                <button class="option-btn" onclick="voteSecondary(3)">Entidades de cultura y memoria</button>
            </div>

            <div id="results" class="results">
                <h3>Resultados en vivo (global)</h3>

                <div class="results-row">
                    <div class="result-header">
                        <span>Inclusi√≥n (PIAR e interculturalidad)</span>
                        <span class="result-label" id="label0">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="bar0" class="bar" style="width:0%"></div>
                    </div>
                </div>

                <div class="results-row">
                    <div class="result-header">
                        <span>Convenios y aliados estrat√©gicos</span>
                        <span class="result-label" id="label1">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="bar1" class="bar" style="width:0%"></div>
                    </div>
                </div>

                <div class="results-row">
                    <div class="result-header">
                        <span>Proyectos transversales y semilleros</span>
                        <span class="result-label" id="label2">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="bar2" class="bar" style="width:0%"></div>
                    </div>
                </div>

                <div class="results-row">
                    <div class="result-header">
                        <span>Emprendimiento y formaci√≥n para el trabajo</span>
                        <span class="result-label" id="label3">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="bar3" class="bar" style="width:0%"></div>
                    </div>
                </div>

                <div class="results-row">
                    <div class="result-header">
                        <span>Organizaciones √©tnicas</span>
                        <span class="result-label" id="labelS0">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="barS0" class="bar" style="width:0%"></div>
                    </div>
                </div>
                <div class="results-row">
                    <div class="result-header">
                        <span>Sector productivo local</span>
                        <span class="result-label" id="labelS1">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="barS1" class="bar" style="width:0%"></div>
                    </div>
                </div>
                <div class="results-row">
                    <div class="result-header">
                        <span>Universidades aliadas</span>
                        <span class="result-label" id="labelS2">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="barS2" class="bar" style="width:0%"></div>
                    </div>
                </div>
                <div class="results-row">
                    <div class="result-header">
                        <span>Entidades de cultura y memoria</span>
                        <span class="result-label" id="labelS3">0 votos (0%)</span>
                    </div>
                    <div class="bar-wrapper">
                        <div id="barS3" class="bar" style="width:0%"></div>
                    </div>
                </div>

                <button id="downloadBtn" onclick="downloadResults()">Descargar resultados (.txt)</button>
                <button id="resetBtn" onclick="resetVotes()">Reiniciar encuesta (solo este dispositivo)</button>
            </div>
        </div>
    </div>

    <div class="card" id="card-muro">
        <h2>üí¨ Muro de aportes comunitarios</h2>
        <p style="font-size:14px;">
            Pide a los asistentes que se conecten al enlace y registren aqu√≠ sus propuestas y compromisos.
            Los aportes se comparten en tiempo real entre todos los dispositivos conectados.
        </p>

        <div class="wall-form">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <select id="wallRole">
                    <option value="Docente">Docente</option>
                    <option value="Estudiante">Estudiante</option>
                    <option value="Padre de familia">Padre de familia</option>
                    <option value="Egresado(a)">Egresado(a)</option>
                    <option value="Aliado comunitario">Aliado comunitario</option>
                </select>
                <select id="wallCategory">
                    <option value="Diagn√≥stico">Diagn√≥stico</option>
                    <option value="Propuesta">Propuesta</option>
                    <option value="Compromiso">Compromiso</option>
                    <option value="Pregunta">Pregunta</option>
                </select>
                <input id="wallName" type="text" placeholder="Nombre (opcional)">
            </div>
            <textarea id="wallText" placeholder="Escribe aqu√≠ la propuesta, compromiso o aporte comunitario..."></textarea>
            <button class="wall-btn" onclick="addWallItem()">Agregar aporte</button>
        </div>

        <div id="wallList" class="wall-list">
        </div>

        <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:8px;">
            <button class="wall-btn" style="background: var(--amarillo-cinta); color:#1f2933;" onclick="downloadWall()">Descargar aportes (.txt)</button>
            <button class="wall-btn" style="background:#e5e7eb; color:#111827;" onclick="clearWall()">Borrar aportes</button>
        </div>
    </div>

</div>

<!-- Bot√≥n y panel de control remoto (solo visible en m√≥vil & solo admin) -->
<button id="controlToggle" class="control-toggle">üéÆ Control</button>
<div id="controlPanel" class="control-panel">
  <div class="control-panel-inner">
    <div class="control-title">Control de presentaci√≥n</div>
    <div class="control-buttons">
      <button class="control-btn" onclick="goSlide('bienvenida')">Bienvenida</button>
      <button class="control-btn" onclick="goSlide('simbolos')">S√≠mbolos</button>
      <button class="control-btn" onclick="goSlide('explorador')">Explorador</button>
      <button class="control-btn" onclick="goSlide('mapa')">Mapa aliados</button>
      <button class="control-btn" onclick="goSlide('encuesta')">Encuesta</button>
      <button class="control-btn" onclick="goSlide('muro')">Muro aportes</button>
    </div>
    <button class="control-close" onclick="closeControlPanel()">Cerrar panel</button>
  </div>
</div>

<footer>
    ENS Gabriela Mistral ‚Äì Orito, Putumayo ¬∑ Componente comunitario del PEI<br>
    Herramienta interactiva presentada por: Prof. Segundo Eduardo Rueda
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, serverTimestamp, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Config de Firebase para tu proyecto
const firebaseConfig = {
  apiKey: "AIzaSyCbZy0Y90YpF_u0KPitL82q_NM0R2oEY24",
  authDomain: "pei-comunitario-ensgm.firebaseapp.com",
  databaseURL: "https://pei-comunitario-ensgm-default-rtdb.firebaseio.com",
  projectId: "pei-comunitario-ensgm",
  storageBucket: "pei-comunitario-ensgm.appspot.com",
  messagingSenderId: "498361581736",
  appId: "1:498361581736:web:34be1f0a8abc6658a5c29d",
  measurementId: "G-7LWXSDTR8E"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const aportesRef = ref(db, "aportes_pei");
const votosRef = ref(db, "votos_pei");
const presentacionRef = ref(db, "presentacion_pei/slide");

// Detectar si este dispositivo tiene acceso de presentador (admin)
const params = new URLSearchParams(window.location.search);
let isAdmin = params.get("admin") === "rueda123";

let votes = [0,0,0,0];
let votesSecondary = [0,0,0,0];
let totalVotes = 0;
let wallCount = 0;
let wallData = [];

function updateIndicators(){
    const votesTotalEl = document.getElementById("votesTotal");
    const wallTotalEl = document.getElementById("wallTotal");
    if (votesTotalEl) votesTotalEl.textContent = totalVotes;
    if (wallTotalEl) wallTotalEl.textContent = wallCount;
}

function toggleSection(id){
    const sec = document.getElementById(id);
    if(!sec) return;
    sec.style.display = (sec.style.display === "block") ? "none" : "block";
}

function showInfo(id){
    document.querySelectorAll(".chip-info").forEach(el => el.style.display = "none");
    const target = document.getElementById(id);
    if(target){
        target.style.display = "block";
        target.scrollIntoView({behavior:"smooth", block:"center"});
    }
}

// --- VOTACI√ìN GLOBAL ---
function vote(index){
    if(index < 0 || index > 3) return;
    const voto = { type: "primary", option: index, ts: serverTimestamp() };
    const res = document.getElementById("results");
    if(res) res.style.display = "block";
    push(votosRef, voto).catch(err => {
        console.error("Error guardando voto:", err);
        alert("No se pudo registrar el voto. Revisa tu conexi√≥n a internet.");
    });
}

function voteSecondary(index){
    if(index < 0 || index > 3) return;
    const voto = { type: "secondary", option: index, ts: serverTimestamp() };
    const res = document.getElementById("results");
    if(res) res.style.display = "block";
    push(votosRef, voto).catch(err => {
        console.error("Error guardando voto:", err);
        alert("No se pudo registrar el voto. Revisa tu conexi√≥n a internet.");
    });
}

onChildAdded(votosRef, (snapshot) => {
    const data = snapshot.val();
    if (!data || typeof data.option !== "number") return;
    if (data.type === "primary" && data.option >= 0 && data.option < 4) {
        votes[data.option]++;
    } else if (data.type === "secondary" && data.option >= 0 && data.option < 4) {
        votesSecondary[data.option]++;
    } else {
        return;
    }
    totalVotes++;
    const resEl = document.getElementById("results");
    if (resEl) resEl.style.display = "block";
    updateBars();
    updateIndicators();
});

function updateBars(){
    const totalPrimary = votes.reduce((a,b)=>a+b,0);
    const totalSecondary = votesSecondary.reduce((a,b)=>a+b,0);

    for(let i=0;i<4;i++){
        const bar = document.getElementById("bar"+i);
        const label = document.getElementById("label"+i);
        let percent = totalPrimary === 0 ? 0 : (votes[i]/totalPrimary)*100;
        if(bar) bar.style.width = percent + "%";
        if(label) label.textContent = `${votes[i]} voto(s) (${percent.toFixed(0)}%)`;
    }
    for(let i=0;i<4;i++){
        const barS = document.getElementById("barS"+i);
        const labelS = document.getElementById("labelS"+i);
        let percentS = totalSecondary === 0 ? 0 : (votesSecondary[i]/totalSecondary)*100;
        if(barS) barS.style.width = percentS + "%";
        if(labelS) labelS.textContent = `${votesSecondary[i]} voto(s) (${percentS.toFixed(0)}%)`;
    }
}

function downloadResults(){
    const content = 
`RESULTADOS DE LA ENCUESTA ‚Äì PEI COMUNITARIO

PREGUNTA 1. ¬øQu√© estrategia debe fortalecerse primero?
- Inclusi√≥n (PIAR e interculturalidad): ${votes[0]} voto(s)
- Convenios y aliados estrat√©gicos:     ${votes[1]} voto(s)
- Proyectos transversales y semilleros: ${votes[2]} voto(s)
- Emprendimiento y formaci√≥n laboral:   ${votes[3]} voto(s)

PREGUNTA 2. ¬øQu√© actor debe reforzar su presencia en la ENS?
- Organizaciones √©tnicas:               ${votesSecondary[0]} voto(s)
- Sector productivo local:              ${votesSecondary[1]} voto(s)
- Universidades aliadas:                ${votesSecondary[2]} voto(s)
- Entidades de cultura y memoria:       ${votesSecondary[3]} voto(s)

Total de votos registrados (global): ${totalVotes}

Generado autom√°ticamente por la presentaci√≥n interactiva del PEI Comunitario.`;

    const blob = new Blob([content], {type:"text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "resultados_encuesta_pei_comunitario.txt";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function resetVotes(){
    votes = [0,0,0,0];
    votesSecondary = [0,0,0,0];
    totalVotes = 0;
    updateBars();
    updateIndicators();
}

// --- MURO DE APORTES ---
function renderWallItem(data){
    const listEl = document.getElementById("wallList");
    if(!listEl || !data) return;

    const role = data.role || "Participante";
    const name = (data.name || "").trim();
    const text = data.text || "";
    const category = data.category || "Aporte";
    const label = name ? (name + " ¬∑ " + role) : role;

    wallData.push({
        role: role,
        name: name,
        category: category,
        text: text
    });

    const item = document.createElement("div");
    item.className = "wall-item";

    const header = document.createElement("div");
    header.className = "wall-item-header";

    const spanLabel = document.createElement("span");
    spanLabel.textContent = label;

    const spanNum = document.createElement("span");
    wallCount++;
    spanNum.textContent = "#" + wallCount;

    header.appendChild(spanLabel);
    header.appendChild(spanNum);

    const meta = document.createElement("div");
    meta.className = "wall-item-meta";
    meta.textContent = `Tipo: ${category}`;

    const body = document.createElement("div");
    body.className = "wall-item-body";
    body.textContent = text;

    item.appendChild(header);
    item.appendChild(meta);
    item.appendChild(body);

    listEl.prepend(item);
    updateIndicators();
}

onChildAdded(aportesRef, (snapshot) => {
    const data = snapshot.val();
    renderWallItem(data);
});

function addWallItem(){
    const textEl = document.getElementById("wallText");
    const roleEl = document.getElementById("wallRole");
    const nameEl = document.getElementById("wallName");
    const catEl  = document.getElementById("wallCategory");

    if(!textEl || !roleEl || !catEl) return;

    const text = (textEl.value || "").trim();
    if(!text){
        alert("Escribe primero el aporte antes de agregarlo.");
        return;
    }

    const role = roleEl.value || "Participante";
    const name = (nameEl.value || "").trim();
    const category = catEl.value || "Aporte";

    const nuevoAporte = {
        text: text,
        role: role,
        name: name,
        category: category,
        ts: serverTimestamp()
    };

    push(aportesRef, nuevoAporte)
        .then(() => {
            textEl.value = "";
        })
        .catch((err) => {
            console.error("Error guardando aporte:", err);
            alert("No se pudo guardar el aporte. Revisa tu conexi√≥n a internet o las reglas de la base de datos.");
        });
}

function downloadWall(){
    if (!wallData || wallData.length === 0) {
        alert("No hay aportes para descargar todav√≠a.");
        return;
    }
    let content = "APORTES DEL MURO ‚Äì PEI COMUNITARIO\n\n";
    wallData.forEach((item, idx) => {
        const nombreParte = item.name ? (" (" + item.name + ")") : "";
        content += (idx + 1) + `. [${item.role}${nombreParte}] ‚Äì ${item.category}\n`;
        content += item.text + "\n\n";
    });
    const blob = new Blob([content], {type:"text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "aportes_muro_pei_comunitario.txt";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function clearWall(){
    const confirmDelete = confirm("¬øSeguro que quieres borrar TODOS los aportes del muro? Esta acci√≥n no se puede deshacer.");
    if (!confirmDelete) return;
    set(aportesRef, null).then(() => {
        const listEl = document.getElementById("wallList");
        if (listEl) listEl.innerHTML = "";
        wallCount = 0;
        wallData = [];
        updateIndicators();
        alert("Aportes borrados correctamente.");
    }).catch((err) => {
        console.error("Error borrando aportes:", err);
        alert("No se pudieron borrar los aportes. Revisa tu conexi√≥n a internet o las reglas de la base de datos.");
    });
}

// --- CONTROL REMOTO DE PRESENTACI√ìN ---
function focusSlide(slideId){
    const map = {
        bienvenida: "card-bienvenida",
        simbolos: "card-simbolos",
        explorador: "card-explorador",
        mapa: "card-mapa",
        encuesta: "card-encuesta",
        muro: "card-muro"
    };
    const cardId = map[slideId];
    if(!cardId) return;
    const el = document.getElementById(cardId);
    if(el){
        el.scrollIntoView({behavior:"smooth", block:"start"});
    }
    if(slideId === "explorador"){
        ["s1","s2","s3","s4","s5"].forEach(id => {
            const sec = document.getElementById(id);
            if(sec) sec.style.display = "block";
        });
    }
}

function goSlide(slideId){
    if (!isAdmin) return; // seguridad extra
    set(presentacionRef, slideId).catch(err => {
        console.error("Error cambiando de slide:", err);
    });
}

// Escucha cambios de slide en tiempo real (todos los dispositivos)
onValue(presentacionRef, (snapshot) => {
    const slide = snapshot.val();
    if(slide){
        focusSlide(slide);
    }
});

function initControlPanel(){
    const toggle = document.getElementById("controlToggle");
    const panel = document.getElementById("controlPanel");
    if(!toggle || !panel) return;

    // Si NO es admin, ocultar bot√≥n y panel
    if (!isAdmin) {
        toggle.style.display = "none";
        panel.style.display = "none";
        return;
    }

    // Solo admin ve y usa el control
    toggle.addEventListener("click", () => {
        panel.style.display = (panel.style.display === "block") ? "none" : "block";
    });
}

function closeControlPanel(){
    const panel = document.getElementById("controlPanel");
    if(panel) panel.style.display = "none";
}

// Exponer funciones al HTML
window.toggleSection   = toggleSection;
window.showInfo        = showInfo;
window.vote            = vote;
window.voteSecondary   = voteSecondary;
window.downloadResults = downloadResults;
window.resetVotes      = resetVotes;
window.addWallItem     = addWallItem;
window.downloadWall    = downloadWall;
window.clearWall       = clearWall;
window.goSlide         = goSlide;
window.closeControlPanel = closeControlPanel;

updateIndicators();
initControlPanel();
</script>

</body>
</html>
